# Sample workflow to access AWS resources when workflow is tied to branch
# The workflow Creates static website using aws s3
name: AWS example workflow
on:
  push:
    branches:
      - '*'
env:
  environment: dev
  name: deploy infrastructure   

jobs:
  Infra:
    name: deploy infrastructure  
    runs-on: ubuntu-latest
    permissions:
      id-token: write   
      packages: write
      contents: read    
    steps:
      - name: Git clone the repository
        uses: actions/checkout@v3
      - name: configure aws credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: arn:aws:iam::603672719972:role/github-oidc-provider
          aws-region: ap-south-1
      - name: Installing serverless
        run: |
          npm install -g serverless
          npm-install-deployment-bucket
      - name: authenticating to AWS
        run: sls config credentials --provider aws --key ${{ env.AWS_ACCESS_KEY_ID }} --secret ${{ env.AWS_SECRET_ACCESS_KEY }}
      - name: deploying infrastructure
        uses: serverless/github-action@3.1
        with:
          args: -c "serverless doctor && serverless deploy --stage dev"
          entrypoint: /bin/sh




